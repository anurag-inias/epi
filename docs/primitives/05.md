# Compute $x + y$ without arithmetical operators

## Description

Add two integers using only bitwise operators.

## Stub

```java
public static int add(int x, int y) {
  // Fill me.
}
```

## Hint

| $a$ | $b$ | $c$ | $sum$ | $carry$ |
| --- | --- | --- | ----- | ------- |
| $0$ | $0$ | $0$ | $0$   | $0$     |
| $1$ | $0$ | $0$ | $1$   | $0$     |
| $0$ | $1$ | $0$ | $1$   | $0$     |
| $0$ | $0$ | $1$ | $1$   | $0$     |
| $1$ | $1$ | $0$ | $0$   | $1$     |
| $1$ | $0$ | $1$ | $0$   | $1$     |
| $0$ | $1$ | $1$ | $0$   | $1$     |
| $1$ | $1$ | $1$ | $1$   | $1$     |

Which suggests that

$$
\begin{align}
sum &= a \oplus b \oplus c \\
carry &= (a \ {\small \&} \ b) \ | \ (b \ {\small \&} \ c) \ | \ (a \ {\small \&} \ c)
\end{align}
$$

## Solution

??? "Expand"

    ![](05.svg){width=400}

    ```kotlin linenums="1"
    fun add(x: Int, y: Int): Int {
      var sum = 0
      var carry = 0
      var i = 0

      var tempX = x
      var tempY = y

      while(tempX != 0 || tempY != 0) { // (1)
        val xm = x and (1 shl i) // (2)
        val ym = y and (1 shl i) // (3)
        sum = sum or (xm xor ym xor carry)
        carry = ((xm and ym) or (xm and carry) or (ym and carry)) shl 1
        i++

        tempX = tempX ushr 1
        tempY = tempY ushr 1
      }

      return sum or carry
    }
    ```

    1. optimized from `while(i < 32)`, so the loop runs only until all bits are exhausted.
    2. Only used to check when all set bits of $x$ are exhausted.
    3. Only used to check when all set bits of $y$ are exhausted.

## Unit tests

```kotlin
@Test
fun first() {
  assertThat(add(1, 2)).isEqualTo(3)
}

@Test
fun second() {
  assertThat(add(19, 5)).isEqualTo(24)
}

@Test
fun third() {
  assertThat(add(-15, -19)).isEqualTo(-34)
}

@Test
fun fourth() {
  assertThat(add(Int.MAX_VALUE, 1)).isEqualTo(Int.MIN_VALUE)
}

@Test
fun fifth() {
  assertThat(add(Int.MIN_VALUE, -1)).isEqualTo(Int.MAX_VALUE)
}

@Test
fun rand() {
  val rand = ThreadLocalRandom.current()

  for (i in 1 until 1000) {
    val a = rand.nextInt()
    val b = rand.nextInt()
    println("adding $a and $b for ${a + b}")
    assertThat(add(a, b)).isEqualTo(a + b)
  }
}
```
